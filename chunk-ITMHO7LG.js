import{c as b}from"./chunk-SAVJUPJR.js";import{a}from"./chunk-VJBOIVAD.js";import{a as x}from"./chunk-PH5NDWNK.js";import{C as n,T as u,W as m,_ as $,da as S,ea as l,g,m as o,za as k}from"./chunk-VN6HQHAM.js";import{a as c,b as f}from"./chunk-A43TDCY5.js";var i=function(e){return e.Signup="/api/signup",e.Signin="/api/signin",e.Logout="/api/logout",e}(i||{}),h=function(e){return e.Profile="/api/profile",e}(h||{});var D=(()=>{let r=class r{constructor(t){this.httpClient=t,this.destroyRef=l(k),this.router=l(b),this.$$authStatus=new g({token:localStorage.getItem("rsToken")||null,success:!1,error:null,role:null}),this.$authStatus=this.$$authStatus.asObservable(),this.$$authStatus.getValue().token&&this.getRole().pipe(a(this.destroyRef)).subscribe()}signUp(t){return this.httpClient.post(i.Signup,t).pipe(u(()=>this.signIn(t)),n(({error:s})=>(this.$$authStatus.next({token:null,success:!1,error:s.message,role:null}),o({status:1,error:s}))))}signIn(t){return this.cleanToken(),this.httpClient.post(i.Signin,t).pipe(u(s=>(this.$$authStatus.next({token:s.token,success:!0,error:null,role:null}),localStorage.setItem("rsToken",s.token),this.getRole())),n(s=>{let{error:p}=s;return this.$$authStatus.next({token:null,success:!1,error:p.message,role:null}),o({status:1,error:p})}))}getRole(){return this.httpClient.get(h.Profile).pipe(u(t=>{let s=f(c({},this.$$authStatus.getValue()),{role:t.role});return this.$$authStatus.next(s),o({status:0,error:null})}),n(({error:t})=>(this.$$authStatus.next({token:null,success:!1,error:t.message,role:null}),o({status:1,error:t}))))}logOut(){this.httpClient.delete(i.Logout).pipe(n(({error:t})=>o({status:1,error:t}))).pipe(m(()=>{this.cleanToken(),this.router.navigate(["/"])}),a(this.destroyRef)).subscribe()}cleanToken(){this.$$authStatus.next({token:null,success:!1,error:null,role:null}),localStorage.removeItem("rsToken")}};r.\u0275fac=function(s){return new(s||r)(S(x))},r.\u0275prov=$({token:r,factory:r.\u0275fac,providedIn:"root"});let e=r;return e})();export{i as a,D as b};
